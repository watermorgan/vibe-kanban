# 06-audit

## 审计目标

验证 `V2-I1-P0-03 Active task hygiene` 的正确性、一致性与可维护性。

## 审计结论

- **结论**: 通过（针对当前范围）。
- **核心结论**: 已实现“单一 active task + 确定性 resume + 读取/写入自愈”。

## 检查清单

- [x] **单一来源**：全局 active 状态仍以 `StarbusGlobalStateData.active_task_id` 为唯一来源。
- [x] **确定性**：候选排序规则固定，含最终 tie-breaker，不依赖非确定性集合遍历顺序。
- [x] **自愈能力**：缺失/无效/终态 active task 在读写链路可被自动修复。
- [x] **行为一致性**：关键 Starbus API 均覆盖 active task 归一化。
- [x] **测试覆盖**：新增单测覆盖保留、自愈、优先级、无候选等核心路径。
- [x] **兼容性**：无 schema 变更，无额外迁移负担。

## 风险与建议

- **中风险**：未来新增状态可能破坏优先级预期。
  - **建议**：新增状态时强制更新 `status_priority` 与配套测试。
- **低风险**：自愈写回发生在请求路径上，极端高并发下可能有最后写入覆盖。
  - **建议**：若后续出现并发争议，引入版本字段或 CAS 语义。

## 后续审计点

- 观察线上日志中 active task 修复频率，判断历史数据质量。
- 如引入前端 resume 展示，补充端到端场景验证（含多任务并发切换）。

